<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Times - Ummah Hub</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/css/prayer-times.css">
</head>
<body>
    <%- include('partials/header') %>
    
    <main>
        <section class="prayer-times-container fade-in">
            <h2>Prayer Times</h2>
            
            <div class="location-input-group">
                <label for="locationInput">Enter your city and country:</label>
                <input 
                    type="text" 
                    id="locationInput" 
                    placeholder="e.g., London, UK" 
                    value="<%= location %>"
                    aria-label="Enter city and country"
                >
                <button onclick="updatePrayerTimes()" aria-label="Update prayer times">
                    Update Times
                </button>
            </div>
            
            <div class="prayer-times">
                <h3>Today's Prayer Times</h3>
                <ul>
                    <li style="--item-index: 0">Fajr <span id="fajr">--:--</span></li>
                    <li style="--item-index: 1">Dhuhr <span id="dhuhr">--:--</span></li>
                    <li style="--item-index: 2">Asr <span id="asr">--:--</span></li>
                    <li style="--item-index: 3">Maghrib <span id="maghrib">--:--</span></li>
                    <li style="--item-index: 4">Isha <span id="isha">--:--</span></li>
                </ul>
            </div>
        </section>
    </main>
    
    <%- include('partials/footer') %>

    <script>
        async function fetchPrayerTimes(city, country) {
            const prayerTimesDiv = document.querySelector('.prayer-times');
            try {
                prayerTimesDiv.classList.add('loading');
                const response = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=2`);
                const data = await response.json();

                if (data.code === 200) {
                    const timings = data.data.timings;
                    document.getElementById('fajr').innerText = timings.Fajr;
                    document.getElementById('dhuhr').innerText = timings.Dhuhr;
                    document.getElementById('asr').innerText = timings.Asr;
                    document.getElementById('maghrib').innerText = timings.Maghrib;
                    document.getElementById('isha').innerText = timings.Isha;
                } else {
                    showError('Could not fetch prayer times. Please check your input.');
                }
            } catch (error) {
                showError('Error fetching prayer times. Please try again.');
            } finally {
                prayerTimesDiv.classList.remove('loading');
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message fade-in';
            errorDiv.style.color = 'red';
            errorDiv.style.marginTop = '1rem';
            errorDiv.style.textAlign = 'center';
            errorDiv.textContent = message;
            
            const existingError = document.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            
            document.querySelector('.prayer-times').insertAdjacentElement('beforebegin', errorDiv);
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function updatePrayerTimes() {
            const locationInput = document.getElementById('locationInput').value;
            const [city, country] = locationInput.split(',').map(s => s.trim());

            if (city && country) {
                fetchPrayerTimes(city, country);
            } else {
                showError('Please enter a valid city and country (e.g., "London, UK")');
            }
        }

        // Initialize prayer times if location is available
        document.addEventListener('DOMContentLoaded', () => {
            const locationValue = "<%= location %>";
            if (locationValue) {
                const [city, country] = locationValue.split(',').map(s => s.trim());
                if (city && country) fetchPrayerTimes(city, country);
            }
        });

        // Add enter key support for the input field
        document.getElementById('locationInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                updatePrayerTimes();
            }
        });
    </script>
</body>
</html>

